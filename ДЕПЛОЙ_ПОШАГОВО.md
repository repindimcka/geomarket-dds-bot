# Геомаркет ДДС-бот: от компьютера до Render (пошагово)

Инструкция «от и до»: выложить код на GitHub и запустить бота на Render.com на бесплатном тарифе.

---

## Часть 1. GitHub — выложить код

### Шаг 1. Установить Git (если ещё нет)

- **macOS:** в «Терминале» выполните:  
  `xcode-select --install`  
  или скачайте Git с [git-scm.com](https://git-scm.com).
- Проверка: в терминале введите `git --version` — должна появиться версия.

### Шаг 2. Зарегистрироваться на GitHub

1. Откройте [github.com](https://github.com).
2. Нажмите **Sign up** и создайте аккаунт (логин, email, пароль).

### Шаг 3. Создать новый репозиторий на GitHub

1. Войдите в GitHub.
2. Справа вверху нажмите **+** → **New repository**.
3. Заполните:
   - **Repository name:** `geomarket-dds-bot` (или другое имя, тогда его же подставьте в команды ниже).
   - **Public**.
   - **НЕ** ставьте галочки «Add a README», «Add .gitignore» — репозиторий создайте **пустым**.
4. Нажмите **Create repository**.

GitHub покажет страницу с командами — они понадобятся в шаге 5.

### Шаг 4. Открыть папку проекта в терминале

В Cursor: **Terminal → New Terminal** или откройте «Терминал» macOS и выполните:

```bash
cd /Users/timofejmitrofanov/geomarket-dds-bot
```

### Шаг 5. Инициализировать Git и отправить код на GitHub

Выполните команды **по очереди**. Вместо `ВАШ_ЛОГИН_GITHUB` подставьте свой логин с GitHub (шаг 2):

```bash
git init
git add .
git status
```

В выводе `git status` **не должно** быть файлов `.env` и `credentials.json` — они в `.gitignore` и в репозиторий не попадут (так и задумано, секреты не выкладываем).

Затем:

```bash
git commit -m "Первый коммит: Geomarket ДДС-бот"
git branch -M main
git remote add origin https://github.com/ВАШ_ЛОГИН_GITHUB/geomarket-dds-bot.git
git push -u origin main
```

- При первом `git push` терминал или браузер попросят войти в GitHub.
- Если просят **пароль** — GitHub больше не принимает пароль при push. Нужен **токен**:  
  GitHub → **Settings** (вашего профиля) → **Developer settings** → **Personal access tokens** → **Tokens (classic)** → **Generate new token** → поставьте право **repo** → скопируйте токен и вставьте его **вместо пароля** в терминале.

После успешного `git push` код будет на GitHub:  
`https://github.com/ВАШ_ЛОГИН_GITHUB/geomarket-dds-bot`.

---

## Часть 2. Render.com — запустить бота бесплатно

На бесплатном тарифе Render даёт **Web Service** (не Background Worker). Бот уже настроен на режим **webhook**: Telegram сам шлёт обновления на ваш сервис.

### Шаг 6. Регистрация на Render

1. Откройте [render.com](https://render.com).
2. Нажмите **Get Started for Free**.
3. Войдите через **GitHub** (удобнее всего — тогда Render сразу видит ваши репозитории).  
   Если входите через Google: потом в **Account Settings** → **Connected accounts** подключите GitHub.

### Шаг 7. Создать Web Service

1. В личном кабинете Render нажмите **New +** → **Web Service**.
2. В списке репозиториев найдите **geomarket-dds-bot** (если нет — **Configure account** и дайте Render доступ к нужному аккаунту/репо).
3. Нажмите **Connect** напротив **geomarket-dds-bot**.

### Шаг 8. Настройки сервиса

Заполните форму:

| Поле | Значение |
|------|----------|
| **Name** | `geomarket-dds-bot` (или любое, от него будет URL, например `https://geomarket-dds-bot.onrender.com`) |
| **Region** | Выберите ближайший (например **Frankfurt**) |
| **Branch** | `main` |
| **Runtime** | **Python 3** |
| **Build Command** | `pip install -r requirements.txt` |
| **Start Command** | `python run_on_render.py` |
| **Instance Type** | **Free** (бесплатный план) |

Переменные окружения добавим в следующем шаге. Пока нажмите **Create Web Service** — Render начнёт первый деплой (он может упасть из‑за отсутствия переменных — это нормально).

### Шаг 9. Узнать URL сервиса и добавить переменные окружения

1. После создания сервиса в **шапке** страницы будет указан URL, например:  
   `https://geomarket-dds-bot-xxxx.onrender.com`  
   **Скопируйте его целиком** (без `/webhook` в конце).

2. В левом меню сервиса откройте **Environment** (или вкладку **Environment**).

3. Нажмите **Add Environment Variable** и добавьте переменные **по одной**:

| Key | Value |
|-----|--------|
| `TELEGRAM_BOT_TOKEN` | Токен бота Geomarket от @BotFather |
| `GOOGLE_SHEET_ID` | ID вашей Google-таблицы Geomarket (из URL: `docs.google.com/spreadsheets/d/ЭТОТ_ID/edit`) |
| `GOOGLE_CREDENTIALS_PATH` | `credentials.json` |
| `CREDENTIALS_JSON` | **Весь текст** из вашего файла `credentials.json` (от первой `{` до последней `}`). Откройте файл в редакторе, скопируйте всё содержимое, вставьте в значение переменной. |
| `WEBHOOK_BASE_URL` | URL из п.1, например `https://geomarket-dds-bot-xxxx.onrender.com` (без слэша в конце, без `/webhook`) |
| `PYTHON_VERSION` | `3.12.7` |

Опционально (если нужно ограничить доступ к боту):

| Key | Value |
|-----|--------|
| `TELEGRAM_ALLOWED_IDS` | Ваш Telegram user id (число) или несколько через запятую |

**Как узнать свой Telegram user id:** напишите боту [@userinfobot](https://t.me/userinfobot) в Telegram — он пришлёт ваш Id.

4. Нажмите **Save Changes**. Render автоматически перезапустит сервис с новыми переменными.

### Шаг 10. Проверить логи и бота

1. В Render откройте вкладку **Logs** вашего сервиса.
2. Должна появиться строка вроде:  
   `[Бот] Режим webhook: https://geomarket-dds-bot-xxxx.onrender.com/webhook ...`
3. Напишите боту в Telegram (например `/start`).  
   Если сервис только что «проснулся», первый ответ может прийти с задержкой **30–60 секунд** — на бесплатном плане это нормально (cold start).

Если в логах ошибка про `CREDENTIALS_JSON` или `credentials.json` — проверьте, что в `CREDENTIALS_JSON` вставлен **полный** JSON (начинается с `{`, заканчивается на `}`), без лишних пробелов в начале/конце.

---

## Краткий чеклист

- [ ] Git установлен, аккаунт GitHub создан.
- [ ] Репозиторий `geomarket-dds-bot` создан на GitHub (пустой, без README).
- [ ] В папке `geomarket-dds-bot` выполнены: `git init`, `git add .`, `git commit`, `git remote add origin`, `git push -u origin main`.
- [ ] Аккаунт Render создан, вход через GitHub.
- [ ] Создан **Web Service** (не Background Worker), репозиторий **geomarket-dds-bot**.
- [ ] Instance Type: **Free**.
- [ ] Build Command: `pip install -r requirements.txt`, Start Command: `python run_on_render.py`.
- [ ] В **Environment** заданы: `TELEGRAM_BOT_TOKEN`, `GOOGLE_SHEET_ID`, `GOOGLE_CREDENTIALS_PATH=credentials.json`, `CREDENTIALS_JSON`, **`WEBHOOK_BASE_URL`** (URL из шапки сервиса), `PYTHON_VERSION=3.12.7`.
- [ ] В **Logs** есть строка про «Режим webhook», бот в Telegram отвечает на /start.

---

## Важно про бесплатный план Render

- Сервис **«засыпает»** после примерно **15 минут** без обращений.
- Как только кто-то пишет боту, Telegram стучится на ваш URL → Render «будит» сервис. Первый ответ после сна может идти 30–60 секунд.
- Для одного бота этого обычно хватает. Если нужна работа без задержек 24/7 — смотрите платные тарифы Render или другой хостинг.

---

Если на каком-то шаге что-то не получается — опишите, на каком шаге вы и что именно видите (текст ошибки или скрин).
